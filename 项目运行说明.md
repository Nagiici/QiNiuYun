# AI角色扮演平台 - 项目运行说明

## 📋 环境要求

### 系统要求
- **操作系统**: Windows 10+, macOS 10.14+, Linux (Ubuntu 18.04+)
- **Node.js**: 版本 16.0+ (推荐 18.x 或 20.x LTS)
- **包管理器**: npm 8.0+ 或 yarn 1.22+
- **内存**: 最少 4GB RAM (推荐 8GB+)
- **存储**: 至少 2GB 可用空间

### 开发工具推荐
- **IDE**: VS Code, WebStorm
- **浏览器**: Chrome 90+, Firefox 88+, Safari 14+
- **终端**: Git Bash (Windows), Terminal (macOS/Linux)

## 🚀 快速开始

### 1. 项目克隆与初始化

```bash
# 1. 克隆项目仓库
git clone <your-repository-url>
cd QiNiuYun

# 2. 安装所有依赖（根目录、前端、后端）
npm run install:all

# 或者分别安装
npm install              # 安装根目录依赖
cd client && npm install # 安装前端依赖
cd ../server && npm install # 安装后端依赖
```

### 2. 环境配置

#### 创建环境变量文件
```bash
# 在 server 目录下创建 .env 文件
cd server
cp .env.example .env  # 如果有示例文件
# 或直接创建 .env 文件
```

#### 基础环境变量配置
```env
# 基础配置（必需）
PORT=8080
NODE_ENV=development

# 数据库配置
DATABASE_PATH=./database.db

# AI API密钥（可选，有免费回退机制）
GROQ_API_KEY=your_groq_key_here
OPENAI_API_KEY=your_openai_key_here
COHERE_API_KEY=your_cohere_key_here
ANTHROPIC_API_KEY=your_anthropic_key_here

# 语音服务配置（可选）
TTS_API_KEY=your_elevenlabs_key_here
TTS_SERVICE_URL=https://api.elevenlabs.io

# Ollama本地配置（可选）
OLLAMA_BASE_URL=http://localhost:11434
```

### 3. 启动开发服务器


#### 分别启动
```bash
# 打开两个终端窗口

# 终端1: 启动后端服务器
cd server
npm run dev

# 终端2: 启动前端开发服务器
cd client
npm run dev
```

### 4. 访问应用

启动成功后，在浏览器中访问：

- **前端应用**: http://localhost:3000
- **后端API**: http://localhost:8080
- **API文档**: http://localhost:8080/api-docs (如果启用)

## 🛠️ 开发脚本说明

### 根目录脚本
```json
{
  "dev": "同时启动前端和后端开发服务器",
  "dev:frontend": "启动前端开发服务器",
  "dev:backend": "启动后端开发服务器",
  "build": "构建前端生产版本",
  "start": "启动生产环境后端服务器",
  "install:all": "安装所有依赖"
}
```

### 前端脚本 (client/)
```json
{
  "dev": "启动Vite开发服务器",
  "build": "TypeScript编译+Vite构建",
  "preview": "预览构建结果"
}
```

### 后端脚本 (server/)
```json
{
  "dev": "使用tsx watch启动开发服务器",
  "build": "TypeScript编译",
  "start": "启动编译后的生产服务器"
}
```

## 🔧 开发配置

### VS Code 推荐配置

创建 `.vscode/settings.json`:
```json
{
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "editor.formatOnSave": true,
  "files.exclude": {
    "**/node_modules": true,
    "**/dist": true,
    "**/.git": true
  }
}
```

推荐插件：
- Vue Language Features (Volar)
- TypeScript Importer
- Tailwind CSS IntelliSense
- Auto Rename Tag
- Bracket Pair Colorizer

### 端口配置

默认端口：
- **前端**: 3000 (Vite) 或 5173 (备用)
- **后端**: 8080
- **WebSocket**: 8080 (与后端共用)

如需修改端口：
```bash
# 前端端口修改 (client/vite.config.ts)
export default defineConfig({
  server: {
    port: 3001  // 修改这里
  }
})

# 后端端口修改 (server/.env)
PORT=8081  # 修改这里
```

## 🐛 常见问题排查

### 问题1: 端口被占用
```bash
# Windows
netstat -ano | findstr :8080
taskkill /PID <PID> /F

# macOS/Linux
lsof -ti:8080 | xargs kill -9
```

### 问题2: 依赖安装失败
```bash
# 清除npm缓存
npm cache clean --force

# 删除node_modules重新安装
rm -rf node_modules package-lock.json
npm install
```

### 问题3: 类型错误
```bash
# 前端TypeScript检查
cd client
npm run build

# 后端TypeScript检查
cd server
npm run build
```

### 问题4: CORS错误
检查后端 `src/index.ts` 中的CORS配置：
```typescript
const corsOptions = {
  origin: ['http://localhost:3000', 'http://localhost:5173'],
  credentials: true
};
```

### 问题5: 数据库初始化失败
```bash
# 删除数据库文件重新初始化
cd server
rm database.db
npm run dev  # 会自动重新创建数据库
```

## 🔍 调试技巧

### 前端调试
```bash
# 开启Vue DevTools
# 在浏览器中安装Vue DevTools扩展

# 查看网络请求
# 浏览器开发者工具 > Network标签

# 查看控制台日志
# 浏览器开发者工具 > Console标签
```

### 后端调试
```bash
# 查看详细日志
cd server
npm run dev

# 使用curl测试API
curl http://localhost:8080/api/characters
curl -X POST http://localhost:8080/api/characters \
  -H "Content-Type: application/json" \
  -d '{"name":"测试角色","description":"测试描述"}'
```

### WebSocket调试
```javascript
// 浏览器控制台中测试WebSocket连接
const ws = new WebSocket('ws://localhost:8080');
ws.onopen = () => console.log('WebSocket连接成功');
ws.onmessage = (event) => console.log('收到消息:', event.data);
ws.onerror = (error) => console.error('WebSocket错误:', error);
```

## 📦 生产环境部署

### 构建应用
```bash
# 构建前端
cd client
npm run build

# 构建后端
cd server
npm run build
```

### 环境变量配置
```env
# 生产环境变量
NODE_ENV=production
PORT=8080
DATABASE_PATH=/app/data/database.db

# 安全配置
CORS_ORIGIN=https://yourdomain.com
SESSION_SECRET=your-super-secret-key

# API密钥（生产环境）
GROQ_API_KEY=prod_groq_key
OPENAI_API_KEY=prod_openai_key
```

### Docker部署（可选）
```dockerfile
# Dockerfile示例
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
EXPOSE 8080
CMD ["npm", "start"]
```

## 🔒 安全注意事项

### 开发环境
- 不要将 `.env` 文件提交到版本控制
- 使用临时的测试API密钥
- 定期更新依赖包

### 生产环境
- 启用HTTPS
- 设置正确的CORS策略
- 使用环境变量管理敏感信息
- 启用日志记录和监控
- 定期备份数据库

## 📞 技术支持

### 常用命令速查
```bash
# 完整重置项目
npm run install:all && npm run dev

# 只启动后端
cd server && npm run dev

# 只启动前端
cd client && npm run dev

# 查看项目状态
npm ls  # 查看依赖树
node --version  # 查看Node版本
npm --version  # 查看npm版本
```

### 获取帮助
- 查看项目README.md了解功能详情
- 查看架构设计文档了解系统结构
- 提交Issue报告问题
- 参考API文档了解接口规范

---
