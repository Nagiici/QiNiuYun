# AIè§’è‰²æ‰®æ¼”å¹³å° - ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸å¼€å‘è§„èŒƒæ–‡æ¡£

## ğŸ“‹ ç›®å½•
- [1. ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
- [2. æ•´ä½“æ¶æ„](#2-æ•´ä½“æ¶æ„)
- [3. æŠ€æœ¯æ ˆè¯¦è§£](#3-æŠ€æœ¯æ ˆè¯¦è§£)
- [4. æ¨¡å—è®¾è®¡](#4-æ¨¡å—è®¾è®¡)
- [5. æ•°æ®åº“è®¾è®¡](#5-æ•°æ®åº“è®¾è®¡)
- [6. APIè®¾è®¡](#6-apiè®¾è®¡)
- [7. å®‰å…¨æ¶æ„](#7-å®‰å…¨æ¶æ„)
- [8. æ€§èƒ½ä¼˜åŒ–](#8-æ€§èƒ½ä¼˜åŒ–)
- [9. éƒ¨ç½²æ¶æ„](#9-éƒ¨ç½²æ¶æ„)
- [10. æ¨¡å—è§„æ ¼ä¸å¼€å‘åˆ†å·¥](#10-æ¨¡å—è§„æ ¼ä¸å¼€å‘åˆ†å·¥)
- [11. æ¥å£è§„èŒƒ](#11-æ¥å£è§„èŒƒ)
- [12. å¼€å‘æµç¨‹](#12-å¼€å‘æµç¨‹)
- [13. è´¨é‡æ ‡å‡†](#13-è´¨é‡æ ‡å‡†)

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 ç³»ç»Ÿå®šä½
AIè§’è‰²æ‰®æ¼”å¹³å°æ˜¯ä¸€ä¸ªå…¨æ ˆWebåº”ç”¨ï¼Œæä¾›æ™ºèƒ½AIè§’è‰²åˆ›å»ºã€å®æ—¶èŠå¤©äº¤äº’ã€è¯­éŸ³å¯¹è¯ç­‰åŠŸèƒ½ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾›æ²‰æµ¸å¼çš„AIä¼™ä¼´ä½“éªŒã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§
- **æ™ºèƒ½è§’è‰²ç³»ç»Ÿ**: 6ç»´ä¸ªæ€§æ¨¡å‹ + è§’è‰²èƒŒæ™¯è®¾å®š
- **å¤šAIæä¾›å•†**: æ”¯æŒGroqã€OpenAIã€Claudeã€Cohereã€Ollama
- **å®æ—¶é€šä¿¡**: WebSocket + HTTP RESTful API
- **è¯­éŸ³äº¤äº’**: è¯­éŸ³è¯†åˆ« + æ–‡æœ¬è½¬è¯­éŸ³
- **å“åº”å¼è®¾è®¡**: æ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯

### 1.3 è®¾è®¡åŸåˆ™
- **æ¨¡å—åŒ–**: é«˜å†…èšã€ä½è€¦åˆçš„æ¨¡å—è®¾è®¡
- **å¯æ‰©å±•æ€§**: æ”¯æŒæ°´å¹³æ‰©å±•å’ŒåŠŸèƒ½æ‰©å±•
- **å®‰å…¨æ€§**: å¤šå±‚å®‰å…¨é˜²æŠ¤æœºåˆ¶
- **æ€§èƒ½**: ä¼˜åŒ–å“åº”æ—¶é—´å’Œç”¨æˆ·ä½“éªŒ
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»“æ„å’Œæ–‡æ¡£

## 2. æ•´ä½“æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vue 3 å‰ç«¯åº”ç”¨ (TypeScript + Vite)                        â”‚
â”‚  â”œâ”€ é¡µé¢ç»„ä»¶ (Views)                                        â”‚
â”‚  â”œâ”€ ä¸šåŠ¡ç»„ä»¶ (Components)                                   â”‚
â”‚  â”œâ”€ çŠ¶æ€ç®¡ç† (Pinia Stores)                                â”‚
â”‚  â””â”€ å·¥å…·å‡½æ•° (Utils)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                        HTTP/WebSocket
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        APIç½‘å…³å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Express.js æœåŠ¡å™¨                                          â”‚
â”‚  â”œâ”€ CORS è·¨åŸŸå¤„ç†                                          â”‚
â”‚  â”œâ”€ è¯·æ±‚é™æµ (Rate Limiting)                                â”‚
â”‚  â”œâ”€ é”™è¯¯å¤„ç†ä¸­é—´ä»¶                                          â”‚
â”‚  â””â”€ è¯·æ±‚æ—¥å¿—è®°å½•                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä¸šåŠ¡é€»è¾‘å±‚            â”‚  â”‚       WebSocketæœåŠ¡å±‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESTful API è·¯ç”±           â”‚  â”‚  å®æ—¶æ¶ˆæ¯å¤„ç†               â”‚
â”‚  â”œâ”€ è§’è‰²ç®¡ç† (/characters)  â”‚  â”‚  â”œâ”€ è¿æ¥ç®¡ç†                â”‚
â”‚  â”œâ”€ èŠå¤©ç®¡ç† (/chats)       â”‚  â”‚  â”œâ”€ æ¶ˆæ¯å¹¿æ’­                â”‚
â”‚  â”œâ”€ AIæœåŠ¡ (/ai)            â”‚  â”‚  â”œâ”€ ä¼šè¯ç®¡ç†                â”‚
â”‚  â””â”€ ç³»ç»Ÿé…ç½® (/system)      â”‚  â”‚  â””â”€ ä¸»åŠ¨èŠå¤©æœåŠ¡            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æœåŠ¡å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AIæœåŠ¡ç®¡ç†å™¨                                               â”‚
â”‚  â”œâ”€ å¤šæä¾›å•†ç®¡ç† (Manager)                                  â”‚
â”‚  â”œâ”€ æä¾›å•†é€‚é…å™¨ (Providers)                                â”‚
â”‚  â”œâ”€ ç†”æ–­å™¨ (Circuit Breaker)                               â”‚
â”‚  â”œâ”€ æƒ…æ„Ÿåˆ†ææœåŠ¡                                            â”‚
â”‚  â””â”€ è¯­éŸ³æœåŠ¡é›†æˆ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å±‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SQLite æ•°æ®åº“                                              â”‚
â”‚  â”œâ”€ ç”¨æˆ·è§’è‰²è¡¨ (characters)                                 â”‚
â”‚  â”œâ”€ èŠå¤©ä¼šè¯è¡¨ (chat_sessions)                              â”‚
â”‚  â”œâ”€ æ¶ˆæ¯è®°å½•è¡¨ (messages)                                   â”‚
â”‚  â”œâ”€ ç³»ç»Ÿé…ç½®è¡¨ (configurations)                             â”‚
â”‚  â””â”€ è§’è‰²ç‰ˆæœ¬è¡¨ (character_versions)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤–éƒ¨æœåŠ¡å±‚                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  AIæä¾›å•†API                                                â”‚
â”‚  â”œâ”€ Groq (å¿«é€Ÿæ¨ç†)                                         â”‚
â”‚  â”œâ”€ OpenAI (GPTæ¨¡å‹)                                        â”‚
â”‚  â”œâ”€ Anthropic (Claude)                                      â”‚
â”‚  â”œâ”€ Cohere (å¯¹è¯ä¼˜åŒ–)                                       â”‚
â”‚  â””â”€ Ollama (æœ¬åœ°éƒ¨ç½²)                                       â”‚
â”‚                                                             â”‚
â”‚  è¯­éŸ³æœåŠ¡                                                   â”‚
â”‚  â”œâ”€ Web Speech API (æµè§ˆå™¨åŸç”Ÿ)                             â”‚
â”‚  â”œâ”€ OpenAI Whisper (è¯­éŸ³è¯†åˆ«)                               â”‚
â”‚  â””â”€ ElevenLabs (é«˜è´¨é‡TTS)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¶æ„ç‰¹ç‚¹

#### **åˆ†å±‚æ¶æ„**
- **è¡¨ç°å±‚**: Vue 3 + TypeScriptï¼Œè´Ÿè´£ç”¨æˆ·äº¤äº’
- **ç½‘å…³å±‚**: Express.jsï¼Œè´Ÿè´£è¯·æ±‚è·¯ç”±å’Œä¸­é—´ä»¶å¤„ç†
- **ä¸šåŠ¡å±‚**: ä¸šåŠ¡é€»è¾‘å¤„ç†å’Œæ•°æ®éªŒè¯
- **æœåŠ¡å±‚**: AIæœåŠ¡é›†æˆå’Œç¬¬ä¸‰æ–¹APIè°ƒç”¨
- **æ•°æ®å±‚**: SQLiteæ•°æ®æŒä¹…åŒ–

#### **å¾®æœåŠ¡åŒ–è®¾è®¡**
- è§’è‰²ç®¡ç†æœåŠ¡
- èŠå¤©æœåŠ¡
- AIæ™ºèƒ½æœåŠ¡
- WebSocketå®æ—¶æœåŠ¡
- æ–‡ä»¶ä¸Šä¼ æœåŠ¡

#### **äº‹ä»¶é©±åŠ¨æ¶æ„**
- WebSocketäº‹ä»¶é©±åŠ¨çš„å®æ—¶é€šä¿¡
- ä¸»åŠ¨èŠå¤©äº‹ä»¶è°ƒåº¦
- ç”¨æˆ·è¡Œä¸ºäº‹ä»¶è¿½è¸ª

## 3. æŠ€æœ¯æ ˆè¯¦è§£

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ä½œç”¨ | é€‰æ‹©ç†ç”± |
|------|------|------|----------|
| **Vue 3** | 3.4+ | å‰ç«¯æ¡†æ¶ | æ¸è¿›å¼æ¡†æ¶ï¼Œç»„åˆå¼APIï¼Œæ€§èƒ½ä¼˜ç§€ |
| **TypeScript** | 5.2+ | ç±»å‹ç³»ç»Ÿ | ç±»å‹å®‰å…¨ï¼Œæå‡å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ |
| **Vite** | 4.4+ | æ„å»ºå·¥å…· | å¿«é€Ÿçƒ­é‡è½½ï¼Œæ¨¡å—åŒ–æ„å»º |
| **Pinia** | 2.1+ | çŠ¶æ€ç®¡ç† | Vue 3å®˜æ–¹æ¨èï¼Œç±»å‹å‹å¥½ |
| **Vue Router** | 4.2+ | è·¯ç”±ç®¡ç† | å®˜æ–¹è·¯ç”±è§£å†³æ–¹æ¡ˆ |
| **TailwindCSS** | 3.3+ | CSSæ¡†æ¶ | å®ç”¨ä¼˜å…ˆï¼Œå¿«é€Ÿæ ·å¼å¼€å‘ |
| **DaisyUI** | 3.9+ | UIç»„ä»¶åº“ | åŸºäºTailwindçš„ç»„ä»¶ç³»ç»Ÿ |
| **Chart.js** | 4.4+ | å›¾è¡¨ç»„ä»¶ | ä¸ªæ€§é›·è¾¾å›¾å±•ç¤º |
| **Axios** | 1.6+ | HTTPå®¢æˆ·ç«¯ | Promise basedï¼Œæ‹¦æˆªå™¨æ”¯æŒ |

### 3.2 åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ä½œç”¨ | é€‰æ‹©ç†ç”± |
|------|------|------|----------|
| **Node.js** | 18+ | è¿è¡Œæ—¶ç¯å¢ƒ | å¼‚æ­¥I/Oï¼Œç”Ÿæ€ä¸°å¯Œ |
| **Express.js** | 4.18+ | Webæ¡†æ¶ | è½»é‡çº§ï¼Œä¸­é—´ä»¶ä¸°å¯Œ |
| **TypeScript** | 5.2+ | ç±»å‹ç³»ç»Ÿ | å…¨æ ˆç±»å‹å®‰å…¨ |
| **SQLite** | 3.x | æ•°æ®åº“ | è½»é‡çº§ï¼Œé›¶é…ç½®ï¼Œæ”¯æŒå¹¶å‘ |
| **WebSocket (ws)** | 8.14+ | å®æ—¶é€šä¿¡ | ä½å»¶è¿ŸåŒå‘é€šä¿¡ |
| **Multer** | 1.4+ | æ–‡ä»¶ä¸Šä¼  | Expressæ–‡ä»¶ä¸Šä¼ ä¸­é—´ä»¶ |
| **Joi** | 18.0+ | æ•°æ®éªŒè¯ | å¼ºå¤§çš„æ•°æ®æ ¡éªŒåº“ |
| **Opossum** | 9.0+ | ç†”æ–­å™¨ | æœåŠ¡é™çº§å’Œå®¹é”™ |

### 3.3 å¼€å‘å·¥å…·

| å·¥å…· | ä½œç”¨ | é…ç½® |
|------|------|------|
| **tsx** | TypeScriptæ‰§è¡Œå™¨ | å¼€å‘ç¯å¢ƒçƒ­é‡è½½ |
| **Concurrently** | å¹¶å‘è„šæœ¬æ‰§è¡Œ | åŒæ—¶å¯åŠ¨å‰åç«¯ |
| **dotenv** | ç¯å¢ƒå˜é‡ç®¡ç† | é…ç½®æ–‡ä»¶åŠ è½½ |
| **CORS** | è·¨åŸŸå¤„ç† | å¼€å‘ç¯å¢ƒCORSé…ç½® |

## 4. æ¨¡å—è®¾è®¡

### 4.1 å‰ç«¯æ¨¡å—æ¶æ„

```
client/src/
â”œâ”€â”€ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ ChatSidebar.vue         # èŠå¤©ä¾§è¾¹æ 
â”‚   â”œâ”€â”€ ImageUpload.vue         # å›¾ç‰‡ä¸Šä¼ ç»„ä»¶
â”‚   â”œâ”€â”€ LoadingSpinner.vue      # åŠ è½½åŠ¨ç”»
â”‚   â”œâ”€â”€ PersonalityRadar.vue    # ä¸ªæ€§é›·è¾¾å›¾
â”‚   â””â”€â”€ VirtualMessageList.vue  # è™šæ‹Ÿæ¶ˆæ¯åˆ—è¡¨
â”‚
â”œâ”€â”€ views/               # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Home.vue                # ä¸»é¡µ
â”‚   â”œâ”€â”€ CreateCharacter.vue     # è§’è‰²åˆ›å»ºé¡µ
â”‚   â”œâ”€â”€ Chat.vue               # èŠå¤©é¡µé¢
â”‚   â””â”€â”€ Settings.vue           # è®¾ç½®é¡µé¢
â”‚
â”œâ”€â”€ stores/              # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ characters.ts           # è§’è‰²çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ chat.ts                # èŠå¤©çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ global.ts              # å…¨å±€çŠ¶æ€ç®¡ç†
â”‚
â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â””â”€â”€ websocketService.ts    # WebSocketæœåŠ¡
â”‚
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ api.ts                 # APIå°è£…
â”‚   â”œâ”€â”€ constants.ts           # å¸¸é‡å®šä¹‰
â”‚   â””â”€â”€ helpers.ts             # è¾…åŠ©å‡½æ•°
â”‚
â”œâ”€â”€ composables/         # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useAudio.ts            # éŸ³é¢‘å¤„ç†
â”‚   â”œâ”€â”€ useChat.ts             # èŠå¤©é€»è¾‘
â”‚   â””â”€â”€ useWebSocket.ts        # WebSocketå°è£…
â”‚
â”œâ”€â”€ App.vue              # æ ¹ç»„ä»¶
â”œâ”€â”€ main.ts             # åº”ç”¨å…¥å£
â””â”€â”€ style.css           # å…¨å±€æ ·å¼
```

### 4.2 åç«¯æ¨¡å—æ¶æ„

```
server/src/
â”œâ”€â”€ routes/              # è·¯ç”±å±‚
â”‚   â”œâ”€â”€ characters.ts           # è§’è‰²ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ chats.ts               # èŠå¤©ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ ai.ts                  # AIæœåŠ¡è·¯ç”±
â”‚   â”œâ”€â”€ ai-new.ts              # æ–°AIæœåŠ¡è·¯ç”±
â”‚   â””â”€â”€ system.ts              # ç³»ç»Ÿé…ç½®è·¯ç”±
â”‚
â”œâ”€â”€ services/            # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ ai/                    # AIæœåŠ¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ index.ts               # AIæœåŠ¡å…¥å£
â”‚   â”‚   â”œâ”€â”€ manager.ts             # AIæœåŠ¡ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ character.ts           # è§’è‰²AIæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ emotion.ts             # æƒ…æ„Ÿåˆ†ææœåŠ¡
â”‚   â”‚   â”œâ”€â”€ config.ts              # AIé…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ providers/             # AIæä¾›å•†é€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ groq.ts               # Groq APIé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ openai.ts             # OpenAI APIé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ anthropic.ts          # Anthropic APIé€‚é…å™¨
â”‚   â”‚       â”œâ”€â”€ cohere.ts             # Cohere APIé€‚é…å™¨
â”‚   â”‚       â””â”€â”€ ollama.ts             # Ollama APIé€‚é…å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ websocketManager.ts    # WebSocketç®¡ç†å™¨
â”‚   â”œâ”€â”€ proactiveChatService.ts # ä¸»åŠ¨èŠå¤©æœåŠ¡
â”‚   â””â”€â”€ circuitBreaker.ts      # ç†”æ–­å™¨æœåŠ¡
â”‚
â”œâ”€â”€ database/            # æ•°æ®åº“å±‚
â”‚   â”œâ”€â”€ index.ts               # æ•°æ®åº“è¿æ¥
â”‚   â”œâ”€â”€ migrations.ts          # æ•°æ®åº“è¿ç§»
â”‚   â””â”€â”€ schemas.ts             # æ•°æ®åº“æ¨¡å¼
â”‚
â”œâ”€â”€ middleware/          # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ rateLimiter.ts         # é™æµä¸­é—´ä»¶
â”‚   â”œâ”€â”€ errorHandler.ts        # é”™è¯¯å¤„ç†ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ validation.ts          # æ•°æ®éªŒè¯ä¸­é—´ä»¶
â”‚   â””â”€â”€ auth.ts                # è®¤è¯ä¸­é—´ä»¶(æœªæ¥)
â”‚
â”œâ”€â”€ types/               # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ character.ts           # è§’è‰²ç±»å‹
â”‚   â”œâ”€â”€ chat.ts                # èŠå¤©ç±»å‹
â”‚   â”œâ”€â”€ ai.ts                  # AIæœåŠ¡ç±»å‹
â”‚   â””â”€â”€ global.ts              # å…¨å±€ç±»å‹
â”‚
â”œâ”€â”€ utils/               # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ logger.ts              # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ helpers.ts             # è¾…åŠ©å‡½æ•°
â”‚   â””â”€â”€ constants.ts           # å¸¸é‡å®šä¹‰
â”‚
â””â”€â”€ index.ts             # åº”ç”¨å…¥å£
```

### 4.3 æ ¸å¿ƒæ¨¡å—è¯¦è§£

#### **è§’è‰²ç®¡ç†æ¨¡å—**
```typescript
// è§’è‰²æœåŠ¡æ¥å£
interface CharacterService {
  create(character: CreateCharacterRequest): Promise<Character>
  update(id: number, character: UpdateCharacterRequest): Promise<Character>
  delete(id: number): Promise<void>
  findById(id: number): Promise<Character | null>
  findAll(): Promise<Character[]>
  findByPersonality(traits: PersonalityTraits): Promise<Character[]>
}

// è§’è‰²æ•°æ®æ¨¡å‹
interface Character {
  id: number
  name: string
  description: string
  storyWorld?: string
  characterBackground?: string
  personalityData: PersonalityData
  personalityPreset?: string
  examples: ConversationExample[]
  avatar?: string
  createdAt: Date
  updatedAt: Date
}
```

#### **AIæœåŠ¡ç®¡ç†æ¨¡å—**
```typescript
// AIæœåŠ¡ç®¡ç†å™¨
class AIServiceManager {
  private providers: Map<string, AIProvider>
  private circuitBreaker: CircuitBreaker

  async chat(request: ChatRequest): Promise<ChatResponse>
  async analyzeEmotion(text: string): Promise<EmotionAnalysis>
  async textToSpeech(text: string, options: TTSOptions): Promise<Buffer>
  async speechToText(audio: Buffer, options: STTOptions): Promise<string>
}

// AIæä¾›å•†é€‚é…å™¨æ¥å£
interface AIProvider {
  name: string
  isAvailable(): Promise<boolean>
  generateResponse(prompt: string, character: Character): Promise<string>
  getUsage(): ProviderUsage
}
```

#### **WebSocketé€šä¿¡æ¨¡å—**
```typescript
// WebSocketç®¡ç†å™¨
class WebSocketManager {
  private connections: Map<string, WebSocket>
  private rooms: Map<string, Set<string>>

  addConnection(userId: string, ws: WebSocket): void
  removeConnection(userId: string): void
  joinRoom(userId: string, roomId: string): void
  leaveRoom(userId: string, roomId: string): void
  broadcastToRoom(roomId: string, message: any): void
  sendToUser(userId: string, message: any): void
}
```

#### **çŠ¶æ€ç®¡ç†æ¨¡å—**
```typescript
// èŠå¤©çŠ¶æ€å­˜å‚¨
export const useChatStore = defineStore('chat', () => {
  const currentSession = ref<ChatSession | null>(null)
  const messages = ref<Message[]>([])
  const isConnected = ref(false)
  const isTyping = ref(false)

  const sendMessage = async (content: string) => { /* ... */ }
  const startVoiceRecording = () => { /* ... */ }
  const stopVoiceRecording = () => { /* ... */ }

  return {
    currentSession,
    messages,
    isConnected,
    isTyping,
    sendMessage,
    startVoiceRecording,
    stopVoiceRecording
  }
})
```

## 5. æ•°æ®åº“è®¾è®¡

### 5.1 æ•°æ®åº“æ¶æ„

```sql
-- è§’è‰²è¡¨
CREATE TABLE characters (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    description TEXT,
    story_world TEXT,
    character_background TEXT,
    has_mission BOOLEAN DEFAULT FALSE,
    current_mission TEXT,
    current_mood TEXT DEFAULT 'neutral',
    time_setting TEXT DEFAULT 'any',
    use_real_time BOOLEAN DEFAULT FALSE,
    personality_preset TEXT,
    personality_data TEXT, -- JSONæ ¼å¼çš„ä¸ªæ€§æ•°æ®
    examples TEXT,         -- JSONæ ¼å¼çš„å¯¹è¯ç¤ºä¾‹
    avatar TEXT,           -- å¤´åƒURL
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- èŠå¤©ä¼šè¯è¡¨
CREATE TABLE chat_sessions (
    id TEXT PRIMARY KEY,
    character_id INTEGER,
    user_id TEXT,
    session_name TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (character_id) REFERENCES characters(id) ON DELETE CASCADE
);

-- æ¶ˆæ¯è¡¨
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id TEXT NOT NULL,
    character_id INTEGER,
    sender_type TEXT NOT NULL, -- 'user' æˆ– 'character'
    content TEXT NOT NULL,
    message_type TEXT DEFAULT 'text', -- 'text', 'voice', 'image'
    metadata TEXT, -- JSONæ ¼å¼çš„å…ƒæ•°æ®
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (session_id) REFERENCES chat_sessions(id) ON DELETE CASCADE,
    FOREIGN KEY (character_id) REFERENCES characters(id) ON DELETE CASCADE
);

-- è§’è‰²ç‰ˆæœ¬è¡¨ï¼ˆç”¨äºè§’è‰²æ›´æ–°å†å²ï¼‰
CREATE TABLE character_versions (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    character_id INTEGER NOT NULL,
    version_number INTEGER NOT NULL,
    character_data TEXT NOT NULL, -- JSONæ ¼å¼çš„å®Œæ•´è§’è‰²æ•°æ®
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (character_id) REFERENCES characters(id) ON DELETE CASCADE
);

-- ç³»ç»Ÿé…ç½®è¡¨
CREATE TABLE configurations (
    key TEXT PRIMARY KEY,
    value TEXT NOT NULL,
    description TEXT,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2 æ•°æ®å…³ç³»å›¾

```
characters (1) â†â†’ (N) chat_sessions (1) â†â†’ (N) messages
    â†“
character_versions (N)

configurations (ç‹¬ç«‹è¡¨)
```

### 5.3 ç´¢å¼•è®¾è®¡

```sql
-- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_messages_session_id ON messages(session_id);
CREATE INDEX idx_messages_created_at ON messages(created_at);
CREATE INDEX idx_chat_sessions_character_id ON chat_sessions(character_id);
CREATE INDEX idx_character_versions_character_id ON character_versions(character_id);
```

## 6. APIè®¾è®¡

### 6.1 RESTful APIè§„èŒƒ

#### **è§’è‰²ç®¡ç†API**
```typescript
// GET /api/characters - è·å–æ‰€æœ‰è§’è‰²
// POST /api/characters - åˆ›å»ºæ–°è§’è‰²
// GET /api/characters/:id - è·å–æŒ‡å®šè§’è‰²
// PUT /api/characters/:id - æ›´æ–°è§’è‰²
// DELETE /api/characters/:id - åˆ é™¤è§’è‰²

interface CreateCharacterRequest {
  name: string
  description: string
  storyWorld?: string
  characterBackground?: string
  personalityData: PersonalityData
  personalityPreset?: string
  examples: ConversationExample[]
}

interface CharacterResponse {
  id: number
  name: string
  description: string
  personalityData: PersonalityData
  avatar?: string
  createdAt: string
  updatedAt: string
}
```

#### **èŠå¤©ç®¡ç†API**
```typescript
// GET /api/chats/sessions - è·å–èŠå¤©ä¼šè¯åˆ—è¡¨
// POST /api/chats/sessions - åˆ›å»ºæ–°ä¼šè¯
// GET /api/chats/sessions/:id/messages - è·å–ä¼šè¯æ¶ˆæ¯
// DELETE /api/chats/sessions/:id - åˆ é™¤ä¼šè¯

interface CreateSessionRequest {
  characterId: number
  sessionName?: string
}

interface SessionResponse {
  id: string
  characterId: number
  characterName: string
  sessionName: string
  lastMessage?: string
  createdAt: string
  updatedAt: string
}
```

#### **AIæœåŠ¡API**
```typescript
// POST /api/ai/chat - AIå¯¹è¯
// POST /api/ai/emotion - æƒ…æ„Ÿåˆ†æ
// POST /api/ai/tts - æ–‡æœ¬è½¬è¯­éŸ³
// POST /api/ai/speech-to-text - è¯­éŸ³è¯†åˆ«
// GET /api/ai/config - è·å–AIé…ç½®
// POST /api/ai/config - æ›´æ–°AIé…ç½®

interface ChatRequest {
  characterId?: number
  sessionId?: string
  message: string
  characterData?: Character // ç”¨äºä¸´æ—¶è§’è‰²
}

interface ChatResponse {
  response: string
  emotion?: EmotionAnalysis
  sessionId: string
  messageId: number
}
```

### 6.2 WebSocket API

#### **è¿æ¥åè®®**
```typescript
// è¿æ¥URL: ws://localhost:8080/ws/{userId}/{roomId}

// æ¶ˆæ¯æ ¼å¼
interface WebSocketMessage {
  type: string
  data: any
  timestamp: number
  messageId?: string
}

// æ¶ˆæ¯ç±»å‹
enum MessageType {
  CHAT_MESSAGE = 'chat_message',
  USER_TYPING = 'user_typing',
  USER_STOP_TYPING = 'user_stop_typing',
  JOIN_ROOM = 'join_room',
  LEAVE_ROOM = 'leave_room',
  SYSTEM_MESSAGE = 'system_message',
  ERROR = 'error'
}
```

#### **å®æ—¶èŠå¤©æµç¨‹**
```typescript
// 1. å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯
{
  type: 'chat_message',
  data: {
    characterId: 1,
    sessionId: 'session-123',
    message: 'ä½ å¥½ï¼',
    messageType: 'text'
  }
}

// 2. æœåŠ¡å™¨å“åº”
{
  type: 'chat_message',
  data: {
    messageId: 456,
    senderId: 'character-1',
    senderType: 'character',
    content: 'ä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼',
    emotion: { joy: 0.8, excitement: 0.6 }
  },
  timestamp: 1635724800000
}
```

## 7. å®‰å…¨æ¶æ„

### 7.1 å¤šå±‚å®‰å…¨é˜²æŠ¤

#### **ç½‘ç»œå±‚å®‰å…¨**
- HTTPSå¼ºåˆ¶é‡å®šå‘
- CORSç­–ç•¥é…ç½®
- Rate Limitingé™æµ
- DDoSé˜²æŠ¤ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

#### **åº”ç”¨å±‚å®‰å…¨**
```typescript
// è¾“å…¥éªŒè¯ä¸­é—´ä»¶
const validateCharacterInput = (req: Request, res: Response, next: NextFunction) => {
  const schema = Joi.object({
    name: Joi.string().min(1).max(100).required(),
    description: Joi.string().max(1000),
    personalityData: Joi.object({
      energy: Joi.number().min(0).max(100),
      friendliness: Joi.number().min(0).max(100),
      // ...
    }).required()
  })

  const { error } = schema.validate(req.body)
  if (error) {
    return res.status(400).json({ error: error.details[0].message })
  }
  next()
}

// SQLæ³¨å…¥é˜²æŠ¤ï¼ˆå‚æ•°åŒ–æŸ¥è¯¢ï¼‰
const getUserCharacters = (userId: string) => {
  return db.all(
    'SELECT * FROM characters WHERE user_id = ?',
    [userId]
  )
}
```

#### **æ•°æ®å±‚å®‰å…¨**
- æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- æ•°æ®åº“è®¿é—®æƒé™æ§åˆ¶
- å®šæœŸæ•°æ®å¤‡ä»½
- æ•°æ®ä¿ç•™ç­–ç•¥

### 7.2 APIå®‰å…¨

#### **è¯·æ±‚é™æµ**
```typescript
// åˆ†çº§é™æµç­–ç•¥
const characterLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 100, // æ¯15åˆ†é’Ÿæœ€å¤š100æ¬¡è¯·æ±‚
  message: 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•'
})

const aiChatLimiter = rateLimit({
  windowMs: 60 * 1000, // 1åˆ†é’Ÿ
  max: 30, // æ¯åˆ†é’Ÿæœ€å¤š30æ¬¡AIå¯¹è¯
  message: 'AIå¯¹è¯è¯·æ±‚è¿‡äºé¢‘ç¹'
})
```

#### **å†…å®¹å®‰å…¨**
```typescript
// å†…å®¹è¿‡æ»¤å’Œæ¸…ç†
const sanitizeInput = (input: string): string => {
  return input
    .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '') // ç§»é™¤è„šæœ¬
    .replace(/javascript:/gi, '') // ç§»é™¤JavaScriptåè®®
    .trim()
    .substring(0, 5000) // é™åˆ¶é•¿åº¦
}
```

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 å‰ç«¯æ€§èƒ½ä¼˜åŒ–

#### **ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½**
```typescript
// è·¯ç”±çº§ä»£ç åˆ†å‰²
const routes = [
  {
    path: '/',
    component: () => import('./views/Home.vue')
  },
  {
    path: '/chat',
    component: () => import('./views/Chat.vue')
  }
]

// ç»„ä»¶æ‡’åŠ è½½
const PersonalityRadar = defineAsyncComponent(() =>
  import('./components/PersonalityRadar.vue')
)
```

#### **è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–**
```typescript
// é•¿æ¶ˆæ¯åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
const VirtualMessageList = {
  setup() {
    const { list, containerProps, wrapperProps } = useVirtualList(
      messages,
      {
        itemHeight: 60,
        overscan: 5
      }
    )

    return { list, containerProps, wrapperProps }
  }
}
```

#### **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**
```typescript
// é€‰æ‹©æ€§çŠ¶æ€è®¢é˜…
const useChatMessages = () => {
  const chatStore = useChatStore()

  // åªè®¢é˜…æ¶ˆæ¯å˜åŒ–
  const messages = computed(() => chatStore.messages)

  // é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
  const messageCount = computed(() => messages.value.length)

  return { messages, messageCount }
}
```

### 8.2 åç«¯æ€§èƒ½ä¼˜åŒ–

#### **æ•°æ®åº“ä¼˜åŒ–**
```typescript
// è¿æ¥æ± é…ç½®
const dbConfig = {
  filename: './database.db',
  mode: sqlite3.OPEN_READWRITE | sqlite3.OPEN_CREATE,
  busyTimeout: 30000,
  pragma: {
    journal_mode: 'WAL',  // Write-Ahead Logging
    synchronous: 'NORMAL',
    temp_store: 'MEMORY',
    mmap_size: 268435456  // 256MB
  }
}

// æŸ¥è¯¢ä¼˜åŒ–
const getRecentMessages = async (sessionId: string, limit: number = 50) => {
  return db.all(`
    SELECT m.*, c.name as character_name
    FROM messages m
    LEFT JOIN characters c ON m.character_id = c.id
    WHERE m.session_id = ?
    ORDER BY m.created_at DESC
    LIMIT ?
  `, [sessionId, limit])
}
```

#### **ç¼“å­˜ç­–ç•¥**
```typescript
// å†…å­˜ç¼“å­˜
const NodeCache = require('node-cache')
const cache = new NodeCache({ stdTTL: 600 }) // 10åˆ†é’Ÿè¿‡æœŸ

const getCachedCharacter = async (id: number): Promise<Character | null> => {
  const cacheKey = `character:${id}`
  let character = cache.get<Character>(cacheKey)

  if (!character) {
    character = await fetchCharacterFromDB(id)
    if (character) {
      cache.set(cacheKey, character)
    }
  }

  return character
}
```

#### **AIæœåŠ¡ä¼˜åŒ–**
```typescript
// å¹¶å‘æ§åˆ¶å’Œç†”æ–­å™¨
class AIProviderManager {
  private circuitBreaker = new CircuitBreaker(this.callAI.bind(this), {
    timeout: 15000,
    errorThresholdPercentage: 50,
    resetTimeout: 30000
  })

  async callAI(prompt: string): Promise<string> {
    // å°è¯•å¤šä¸ªæä¾›å•†ï¼Œç›´åˆ°æˆåŠŸ
    const providers = ['groq', 'openai', 'cohere']

    for (const provider of providers) {
      try {
        return await this.circuitBreaker.fire(prompt, provider)
      } catch (error) {
        console.warn(`Provider ${provider} failed:`, error.message)
        continue
      }
    }

    throw new Error('All AI providers unavailable')
  }
}
```

### 8.3 WebSocketæ€§èƒ½ä¼˜åŒ–

#### **è¿æ¥ç®¡ç†**
```typescript
class WebSocketManager {
  private connections = new Map<string, WebSocket>()
  private rooms = new Map<string, Set<string>>()
  private heartbeatInterval = 30000

  // å¿ƒè·³æ£€æµ‹
  startHeartbeat(userId: string) {
    const interval = setInterval(() => {
      const ws = this.connections.get(userId)
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.ping()
      } else {
        this.removeConnection(userId)
        clearInterval(interval)
      }
    }, this.heartbeatInterval)
  }

  // æ¶ˆæ¯å‹ç¼©
  broadcast(roomId: string, message: any) {
    const compressed = this.compressMessage(message)
    const room = this.rooms.get(roomId)

    if (room) {
      room.forEach(userId => {
        const ws = this.connections.get(userId)
        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send(compressed)
        }
      })
    }
  }
}
```

## 9. éƒ¨ç½²æ¶æ„

### 9.1 å¼€å‘ç¯å¢ƒ

```yaml
# docker-compose.dev.yml
version: '3.8'
services:
  frontend:
    build:
      context: ./client
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      - ./client:/app
      - /app/node_modules
    environment:
      - VITE_API_BASE_URL=http://localhost:8080

  backend:
    build:
      context: ./server
      dockerfile: Dockerfile.dev
    ports:
      - "8080:8080"
    volumes:
      - ./server:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - PORT=8080
```

### 9.2 ç”Ÿäº§ç¯å¢ƒ

#### **DockeråŒ–éƒ¨ç½²**
```dockerfile
# å‰ç«¯ Dockerfile
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf
EXPOSE 80

# åç«¯ Dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production
COPY . .
RUN npm run build
EXPOSE 8080
CMD ["npm", "start"]
```

#### **è´Ÿè½½å‡è¡¡é…ç½®**
```nginx
# nginx.conf
upstream backend {
    server backend1:8080;
    server backend2:8080;
    server backend3:8080;
}

server {
    listen 80;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # WebSocketä»£ç†
    location /ws/ {
        proxy_pass http://backend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
    }
}
```

### 9.3 ç›‘æ§å’Œæ—¥å¿—

#### **åº”ç”¨ç›‘æ§**
```typescript
// å¥åº·æ£€æŸ¥ç«¯ç‚¹
app.get('/health', (req, res) => {
  res.json({
    status: 'OK',
    timestamp: new Date().toISOString(),
    uptime: process.uptime(),
    memory: process.memoryUsage(),
    database: db ? 'connected' : 'disconnected'
  })
})

// æ€§èƒ½æŒ‡æ ‡æ”¶é›†
const collectMetrics = () => {
  return {
    activeConnections: wsManager.getConnectionCount(),
    totalSessions: sessionManager.getSessionCount(),
    aiRequestsPerMinute: aiService.getRequestRate(),
    errorRate: errorTracker.getErrorRate()
  }
}
```

#### **æ—¥å¿—ç®¡ç†**
```typescript
// ç»“æ„åŒ–æ—¥å¿—
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.errors({ stack: true }),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
    new winston.transports.Console({
      format: winston.format.simple()
    })
  ]
})
```

## 10. æ¨¡å—è§„æ ¼ä¸å¼€å‘åˆ†å·¥

### 10.1 é¡¹ç›®æ¨¡å—æ¦‚è§ˆ

#### **10.1.1 æ¨¡å—æ¶æ„å›¾**

```
AIè§’è‰²æ‰®æ¼”å¹³å°
â”œâ”€â”€ å‰ç«¯æ¨¡å— (Client)
â”‚   â”œâ”€â”€ ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)
â”‚   â”œâ”€â”€ çŠ¶æ€ç®¡ç†å±‚ (State Layer)
â”‚   â”œâ”€â”€ æœåŠ¡å±‚ (Service Layer)
â”‚   â””â”€â”€ å·¥å…·å±‚ (Utils Layer)
â”‚
â”œâ”€â”€ åç«¯æ¨¡å— (Server)
â”‚   â”œâ”€â”€ è·¯ç”±å±‚ (Route Layer)
â”‚   â”œâ”€â”€ ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)
â”‚   â”œâ”€â”€ æœåŠ¡å±‚ (Service Layer)
â”‚   â”œâ”€â”€ æ•°æ®è®¿é—®å±‚ (Data Layer)
â”‚   â””â”€â”€ ä¸­é—´ä»¶å±‚ (Middleware Layer)
â”‚
â””â”€â”€ å…±äº«æ¨¡å— (Shared)
    â”œâ”€â”€ ç±»å‹å®šä¹‰ (Type Definitions)
    â”œâ”€â”€ å¸¸é‡å®šä¹‰ (Constants)
    â””â”€â”€ å·¥å…·å‡½æ•° (Utils)
```

#### **10.1.2 æŠ€æœ¯æ ˆåˆ†å·¥**

| å±‚çº§ | æŠ€æœ¯æ ˆ | ä¸»è¦èŒè´£ |  è´Ÿè´£äºº |
|------|--------|----------|--------------|
| **å‰ç«¯** | Vue 3 + TypeScript | ç”¨æˆ·ç•Œé¢ã€äº¤äº’é€»è¾‘ | æ›¹å® |
| **åç«¯** | Node.js + Express | APIæœåŠ¡ã€ä¸šåŠ¡é€»è¾‘ | ç½—ä¸¹ |
| **æ•°æ®åº“** | SQLite | æ•°æ®å­˜å‚¨ã€æŸ¥è¯¢ä¼˜åŒ– | ç½—ä¸¹ |
| **AIé›†æˆ** | å¤šæä¾›å•†API | AIæœåŠ¡é›†æˆã€ä¼˜åŒ– | ç½—ä¸¹ |
| **å®æ—¶é€šä¿¡** | WebSocket | å®æ—¶æ¶ˆæ¯ã€çŠ¶æ€åŒæ­¥ | æ›¹å® |

### 10.2 å‰ç«¯æ¨¡å—è§„æ ¼

#### **10.2.1 ä¸»é¡µæ¨¡å— (Home.vue)**
```typescript
// æ¨¡å—èŒè´£ï¼šç”¨æˆ·å…¥å£ã€è§’è‰²å±•ç¤ºã€å¯¼èˆªåŠŸèƒ½
export interface HomePageModule {
  // æ ¸å¿ƒåŠŸèƒ½
  displayFeaturedCharacters(): Promise<Character[]>
  searchCharacters(query: string): Promise<Character[]>
  filterCharactersByPersonality(traits: PersonalityFilter): Promise<Character[]>
  navigateToCharacterChat(characterId: number): void
  navigateToCharacterCreation(): void

  // çŠ¶æ€ç®¡ç†
  featuredCharacters: Ref<Character[]>
  searchQuery: Ref<string>
  isLoading: Ref<boolean>
  currentFilter: Ref<PersonalityFilter>

  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
  onMounted(): Promise<void>
  onUnmounted(): void
}
```

**å¼€å‘ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å“åº”å¼å¸ƒå±€è®¾è®¡ä¸å®ç°
- [ ] è§’è‰²å¡ç‰‡ç»„ä»¶å¼€å‘
- [ ] æœç´¢å’Œç­›é€‰åŠŸèƒ½
- [ ] åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†
- [ ] ç§»åŠ¨ç«¯é€‚é…ä¼˜åŒ–
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‡’åŠ è½½ã€è™šæ‹Ÿæ»šåŠ¨ï¼‰

#### **10.2.2 è§’è‰²åˆ›å»ºæ¨¡å— (CreateCharacter.vue)**
```typescript
// æ¨¡å—èŒè´£ï¼šè§’è‰²åˆ›å»ºã€ç¼–è¾‘ã€é¢„è§ˆ
export interface CharacterCreationModule {
  // è¡¨å•ç®¡ç†
  characterForm: Ref<CharacterFormData>
  formValidation: ComputedRef<ValidationResult>

  // ä¸ªæ€§ç³»ç»Ÿ
  personalityRadar: Ref<PersonalityData>
  personalityPresets: Ref<PersonalityPreset[]>

  // æ–‡ä»¶ä¸Šä¼ 
  avatarUpload: {
    uploadFile(file: File): Promise<string>
    previewImage: Ref<string | null>
    uploadProgress: Ref<number>
  }

  // æ ¸å¿ƒåŠŸèƒ½
  saveCharacter(): Promise<Character>
  previewCharacter(): void
  resetForm(): void
  loadCharacterForEdit(id: number): Promise<void>
}
```

**å¼€å‘ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¤šæ­¥éª¤è¡¨å•è®¾è®¡
- [ ] ä¸ªæ€§é›·è¾¾å›¾ç»„ä»¶
- [ ] æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
- [ ] è¡¨å•éªŒè¯é€»è¾‘
- [ ] è§’è‰²é¢„è§ˆåŠŸèƒ½
- [ ] æ•°æ®æŒä¹…åŒ–

#### **10.2.3 èŠå¤©ç•Œé¢æ¨¡å— (Chat.vue)**
```typescript
// æ¨¡å—èŒè´£ï¼šå®æ—¶èŠå¤©ã€è¯­éŸ³äº¤äº’ã€æ¶ˆæ¯ç®¡ç†
export interface ChatInterfaceModule {
  // æ¶ˆæ¯ç®¡ç†
  messages: Ref<Message[]>
  currentSession: Ref<ChatSession | null>
  isTyping: Ref<boolean>

  // è¯­éŸ³åŠŸèƒ½
  voiceRecording: {
    isRecording: Ref<boolean>
    audioBlob: Ref<Blob | null>
    startRecording(): Promise<void>
    stopRecording(): Promise<string>  // è¿”å›è¯†åˆ«çš„æ–‡æœ¬
  }

  // å®æ—¶é€šä¿¡
  websocket: {
    isConnected: Ref<boolean>
    connect(sessionId: string): Promise<void>
    disconnect(): void
    sendMessage(content: string): void
    onMessageReceived(callback: (message: Message) => void): void
  }

  // æ ¸å¿ƒåŠŸèƒ½
  sendTextMessage(content: string): Promise<void>
  sendVoiceMessage(audioBlob: Blob): Promise<void>
  clearChatHistory(): Promise<void>
  exportChatHistory(): Promise<string>
}
```

**å¼€å‘ä»»åŠ¡æ¸…å•ï¼š**
- [ ] æ¶ˆæ¯åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨
- [ ] è¯­éŸ³å½•åˆ¶ä¸æ’­æ”¾
- [ ] WebSocketè¿æ¥ç®¡ç†
- [ ] æ¶ˆæ¯çŠ¶æ€æŒ‡ç¤ºå™¨
- [ ] è¡¨æƒ…å’Œå¯Œæ–‡æœ¬æ”¯æŒ
- [ ] èŠå¤©è®°å½•å¯¼å‡º

### 10.3 åç«¯æ¨¡å—è§„æ ¼

#### **10.3.1 è§’è‰²ç®¡ç†è·¯ç”± (characters.ts)**
```typescript
// è·¯ç”±èŒè´£ï¼šè§’è‰²CRUD APIç«¯ç‚¹
export interface CharactersRouteModule {
  // APIç«¯ç‚¹
  'GET /api/characters': () => Promise<Character[]>
  'POST /api/characters': (data: CreateCharacterRequest) => Promise<Character>
  'GET /api/characters/:id': (id: number) => Promise<Character>
  'PUT /api/characters/:id': (id: number, data: UpdateCharacterRequest) => Promise<Character>
  'DELETE /api/characters/:id': (id: number) => Promise<void>

  // æ‰©å±•ç«¯ç‚¹
  'GET /api/characters/search': (query: string) => Promise<Character[]>
  'GET /api/characters/popular': () => Promise<Character[]>
  'POST /api/characters/:id/duplicate': (id: number) => Promise<Character>
}
```

**å¼€å‘ä»»åŠ¡æ¸…å•ï¼š**
- [ ] RESTful APIç«¯ç‚¹å®ç°
- [ ] è¯·æ±‚æ•°æ®éªŒè¯
- [ ] é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- [ ] APIæ–‡æ¡£ç”Ÿæˆ
- [ ] å•å…ƒæµ‹è¯•ç¼–å†™

#### **10.3.2 AIæœåŠ¡ç®¡ç†å™¨ (ai/manager.ts)**
```typescript
// æœåŠ¡èŒè´£ï¼šAIæä¾›å•†ç®¡ç†å’Œè°ƒåº¦
export class AIServiceManager {
  private providers: Map<string, AIProvider>
  private circuitBreaker: CircuitBreaker
  private cache: NodeCache
  private config: AIConfiguration

  // æ ¸å¿ƒæ–¹æ³•
  async generateResponse(request: ChatRequest): Promise<ChatResponse>
  async analyzeEmotion(text: string): Promise<EmotionAnalysis>
  async textToSpeech(text: string, options: TTSOptions): Promise<Buffer>
  async speechToText(audio: Buffer, options: STTOptions): Promise<string>
}
```

**å¼€å‘ä»»åŠ¡æ¸…å•ï¼š**
- [ ] å¤šæä¾›å•†é€‚é…å™¨å®ç°
- [ ] ç†”æ–­å™¨é›†æˆ
- [ ] ç¼“å­˜ç­–ç•¥å®ç°
- [ ] è´Ÿè½½å‡è¡¡ç®—æ³•
- [ ] ä½¿ç”¨é‡ç»Ÿè®¡
- [ ] é”™è¯¯æ¢å¤æœºåˆ¶



## 10. æ¥å£è§„èŒƒ

### 10.1 å‰åç«¯é€šä¿¡åè®®

#### **10.1.1 HTTP APIè§„èŒƒ**

**URLè§„èŒƒ:**
```
https://api.domain.com/api/v1/{resource}/{id?}/{action?}

ç¤ºä¾‹ï¼š
GET    /api/v1/characters           # è·å–è§’è‰²åˆ—è¡¨
POST   /api/v1/characters           # åˆ›å»ºè§’è‰²
GET    /api/v1/characters/123       # è·å–ç‰¹å®šè§’è‰²
PUT    /api/v1/characters/123       # æ›´æ–°è§’è‰²
DELETE /api/v1/characters/123       # åˆ é™¤è§’è‰²
POST   /api/v1/characters/123/chat  # ä¸è§’è‰²å¯¹è¯
```

**è¯·æ±‚æ ¼å¼:**
```typescript
// æ ‡å‡†è¯·æ±‚å¤´
interface RequestHeaders {
  'Content-Type': 'application/json'
  'Accept': 'application/json'
  'User-Agent': string
  'X-Request-ID': string  // è¯·æ±‚è¿½è¸ªID
}

// æ ‡å‡†å“åº”æ ¼å¼
interface ApiResponse<T = any> {
  success: true
  data: T
  metadata: {
    timestamp: number
    requestId: string
    executionTime: number
  }
}

// é”™è¯¯å“åº”
interface ApiError {
  success: false
  error: {
    code: string
    message: string
    details?: any
  }
  metadata: {
    timestamp: number
    requestId: string
  }
}
```

#### **11.1.2 WebSocketé€šä¿¡åè®®**

```typescript
// åŸºç¡€æ¶ˆæ¯ç»“æ„
interface WebSocketMessage {
  type: MessageType
  data: any
  timestamp: number
  messageId?: string
  acknowledgment?: boolean  // æ˜¯å¦éœ€è¦ç¡®è®¤
}

// æ¶ˆæ¯ç±»å‹æšä¸¾
enum MessageType {
  CHAT_MESSAGE = 'chat_message',
  USER_TYPING = 'user_typing',
  USER_STOP_TYPING = 'user_stop_typing',
  JOIN_ROOM = 'join_room',
  LEAVE_ROOM = 'leave_room',
  SYSTEM_MESSAGE = 'system_message',
  ERROR = 'error',
  HEARTBEAT = 'heartbeat'
}
```

### 10.2 æ•°æ®æ¨¡å‹è§„èŒƒ

```typescript
// è§’è‰²å®ä½“
interface Character {
  id: number
  name: string
  description: string
  storyWorld?: string
  characterBackground?: string
  hasMission: boolean
  currentMission?: string
  currentMood: string
  timeSetting: string
  useRealTime: boolean
  personalityPreset?: string
  personalityData: PersonalityData
  examples: ConversationExample[]
  avatar?: string
  createdAt: Date
  updatedAt: Date
}

// ä¸ªæ€§æ•°æ®
interface PersonalityData {
  energy: number        // èƒ½é‡ (0-100)
  friendliness: number  // å‹å¥½åº¦ (0-100)
  humor: number         // å¹½é»˜æ„Ÿ (0-100)
  professionalism: number // ä¸“ä¸šæ€§ (0-100)
  creativity: number    // åˆ›é€ åŠ› (0-100)
  empathy: number       // åŒç†å¿ƒ (0-100)
}

// æ¶ˆæ¯å®ä½“
interface Message {
  id: number
  sessionId: string
  characterId?: number
  senderId: string
  senderType: 'user' | 'character'
  content: string
  messageType: 'text' | 'voice' | 'image'
  emotion?: EmotionAnalysis
  metadata?: MessageMetadata
  createdAt: Date
}
```

## 11. å¼€å‘æµç¨‹

### 11.1 Gitå·¥ä½œæµ

#### **11.1.1 åˆ†æ”¯ç­–ç•¥**

```
main (ç”Ÿäº§åˆ†æ”¯)
  â”œâ”€â”€ develop (å¼€å‘åˆ†æ”¯)
  â”‚   â”œâ”€â”€ feature/user-interface (åŠŸèƒ½åˆ†æ”¯)
  â”‚   â”œâ”€â”€ feature/ai-integration
  â”‚   â”œâ”€â”€ feature/voice-chat
  â”‚   â””â”€â”€ feature/real-time-chat
  â”‚
  â”œâ”€â”€ release/v1.0 (å‘å¸ƒåˆ†æ”¯)
  â””â”€â”€ hotfix/critical-bug (çƒ­ä¿®å¤åˆ†æ”¯)
```

**åˆ†æ”¯å‘½åè§„èŒƒ:**
- `feature/åŠŸèƒ½åç§°`: æ–°åŠŸèƒ½å¼€å‘
- `bugfix/é—®é¢˜æè¿°`: Bugä¿®å¤
- `hotfix/ç´§æ€¥ä¿®å¤`: ç´§æ€¥ä¿®å¤
- `release/ç‰ˆæœ¬å·`: å‘å¸ƒå‡†å¤‡
- `experiment/å®éªŒåç§°`: å®éªŒæ€§åŠŸèƒ½

#### **11.1.2 æäº¤è§„èŒƒ**

```bash
# æäº¤æ¶ˆæ¯æ ¼å¼
<type>(<scope>): <subject>

<body>

<footer>

# ç¤ºä¾‹
feat(chat): add voice message support

Add voice recording and playback functionality for chat messages.
- Implement voice recording with Web API
- Add audio playback controls
- Support voice message storage

Closes #123
```

**Typeç±»å‹:**
- `feat`: æ–°åŠŸèƒ½
- `fix`: Bugä¿®å¤
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼åŒ–
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

### 11.2 ä»£ç è´¨é‡æ ‡å‡†

#### **11.2.1 TypeScriptç¼–ç è§„èŒƒ**

```typescript
// å‘½åçº¦å®š
interface UserPreferences {  // æ¥å£ï¼šPascalCase
  themeMode: 'light' | 'dark'  // å±æ€§ï¼šcamelCase
  fontSize: number
}

class CharacterService {  // ç±»ï¼šPascalCase
  private apiClient: ApiClient  // ç§æœ‰æˆå‘˜ï¼šcamelCaseå‰ç¼€

  public async createCharacter(  // æ–¹æ³•ï¼šcamelCase
    characterData: CreateCharacterRequest  // å‚æ•°ï¼šcamelCase
  ): Promise<Character> {
    // å®ç°
  }
}

const API_BASE_URL = 'https://api.example.com'  // å¸¸é‡ï¼šSCREAMING_SNAKE_CASE
```

### 11.3 æµ‹è¯•ç­–ç•¥

#### **11.3.1 å•å…ƒæµ‹è¯•**

```typescript
// å‰ç«¯ç»„ä»¶æµ‹è¯• (Vitest + Vue Test Utils)
import { mount } from '@vue/test-utils'
import { describe, it, expect } from 'vitest'
import CharacterCard from './CharacterCard.vue'

describe('CharacterCard', () => {
  const mockCharacter = {
    id: 1,
    name: 'Test Character',
    description: 'A test character',
    personalityData: {
      energy: 80,
      friendliness: 70,
      humor: 60,
      professionalism: 50,
      creativity: 90,
      empathy: 85
    }
  }

  it('renders character information correctly', () => {
    const wrapper = mount(CharacterCard, {
      props: { character: mockCharacter }
    })

    expect(wrapper.text()).toContain('Test Character')
    expect(wrapper.text()).toContain('A test character')
  })
})
```

## 12. è´¨é‡æ ‡å‡†

### 12.1 æ€§èƒ½è¦æ±‚

#### **12.1.1 å‰ç«¯æ€§èƒ½æŒ‡æ ‡**

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|----------|
| **é¦–æ¬¡å†…å®¹ç»˜åˆ¶ (FCP)** | < 1.5s | Lighthouse |
| **æœ€å¤§å†…å®¹ç»˜åˆ¶ (LCP)** | < 2.5s | Web Vitals |
| **é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ (FID)** | < 100ms | Real User Monitoring |
| **ç´¯ç§¯å¸ƒå±€åç§» (CLS)** | < 0.1 | Web Vitals |
| **äº¤äº’åˆ°ä¸‹æ¬¡ç»˜åˆ¶ (INP)** | < 200ms | Web Vitals |

#### **12.1.2 åç«¯æ€§èƒ½æŒ‡æ ‡**

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹æ³• |
|------|--------|----------|
| **APIå“åº”æ—¶é—´** | < 500ms (95%) | APMå·¥å…· |
| **AIå¯¹è¯ç”Ÿæˆ** | < 5s | è‡ªå®šä¹‰ç›‘æ§ |
| **WebSocketå»¶è¿Ÿ** | < 100ms | ç½‘ç»œç›‘æ§ |
| **æ•°æ®åº“æŸ¥è¯¢** | < 100ms (95%) | æŸ¥è¯¢åˆ†æå™¨ |
| **å¹¶å‘è¿æ¥** | 1000+ | è´Ÿè½½æµ‹è¯• |

### 12.2 ä»£ç è´¨é‡æŒ‡æ ‡

#### **12.2.1 é™æ€ä»£ç åˆ†æ**

```json
// .eslintrc.js
module.exports = {
  extends: [
    '@vue/typescript/recommended',
    '@vue/prettier',
    '@vue/prettier/@typescript-eslint'
  ],
  rules: {
    'complexity': ['error', 10],        // åœˆå¤æ‚åº¦ < 10
    'max-lines': ['error', 300],        // æ–‡ä»¶è¡Œæ•° < 300
    'max-lines-per-function': ['error', 50], // å‡½æ•°è¡Œæ•° < 50
    'max-params': ['error', 4],         // å‚æ•°ä¸ªæ•° < 4
    'max-depth': ['error', 4],          // åµŒå¥—æ·±åº¦ < 4
    'no-console': 'warn',               // ç¦ç”¨console
    'no-debugger': 'error'              // ç¦ç”¨debugger
  }
}
```

#### **12.2.2 æµ‹è¯•è¦†ç›–ç‡è¦æ±‚**

| ç±»å‹ | è¦†ç›–ç‡è¦æ±‚ | å·¥å…· |
|------|------------|------|
| **å•å…ƒæµ‹è¯•** | > 80% | Vitest, Jest |
| **é›†æˆæµ‹è¯•** | > 60% | Cypress, Playwright |
| **APIæµ‹è¯•** | > 90% | Supertest |
| **ç«¯åˆ°ç«¯æµ‹è¯•** | > 50% | Cypress |

### 12.3 å®‰å…¨æ ‡å‡†

#### **12.3.1 å®‰å…¨æ£€æŸ¥æ¸…å•**

```typescript
// å®‰å…¨ä¸­é—´ä»¶ç¤ºä¾‹
const securityMiddleware = [
  helmet(),                    // å®‰å…¨å¤´éƒ¨
  rateLimit({                 // è¯·æ±‚é™æµ
    windowMs: 15 * 60 * 1000,
    max: 100
  }),
  cors({                      // CORSé…ç½®
    origin: process.env.ALLOWED_ORIGINS?.split(','),
    credentials: true
  }),
  express.json({ limit: '10mb' }), // è¯·æ±‚ä½“å¤§å°é™åˆ¶
  sanitizeInput,              // è¾“å…¥æ¸…ç†
  validateJWT                 // JWTéªŒè¯ï¼ˆæœªæ¥ï¼‰
]

// è¾“å…¥éªŒè¯ç¤ºä¾‹
const characterValidation = Joi.object({
  name: Joi.string().min(1).max(100).required(),
  description: Joi.string().max(1000),
  personalityData: Joi.object({
    energy: Joi.number().min(0).max(100).required(),
    friendliness: Joi.number().min(0).max(100).required(),
    humor: Joi.number().min(0).max(100).required(),
    professionalism: Joi.number().min(0).max(100).required(),
    creativity: Joi.number().min(0).max(100).required(),
    empathy: Joi.number().min(0).max(100).required()
  }).required()
})
```

---

## æ€»ç»“

æœ¬æ¶æ„è®¾è®¡ä¸å¼€å‘è§„èŒƒæ–‡æ¡£æä¾›äº†AIè§’è‰²æ‰®æ¼”å¹³å°çš„å®Œæ•´æŠ€æœ¯æ¶æ„æ–¹æ¡ˆå’Œå¼€å‘æŒ‡å¯¼ï¼ŒåŒ…æ‹¬ï¼š

1. **æ¸…æ™°çš„åˆ†å±‚æ¶æ„**ï¼šå‰ç«¯ã€ç½‘å…³ã€ä¸šåŠ¡ã€æœåŠ¡ã€æ•°æ®å±‚åˆ†ç¦»
2. **æ¨¡å—åŒ–è®¾è®¡**ï¼šé«˜å†…èšã€ä½è€¦åˆçš„æ¨¡å—åˆ’åˆ†
3. **è¯¦ç»†çš„å¼€å‘è§„èŒƒ**ï¼šæ¨¡å—è§„æ ¼ã€æ¥å£æ ‡å‡†ã€å¼€å‘æµç¨‹
4. **æ˜ç¡®çš„åˆ†å·¥å®‰æ’**ï¼šå›¢é˜Ÿè§’è‰²å’Œå¼€å‘ä»»åŠ¡åˆ†é…
5. **ä¸¥æ ¼çš„è´¨é‡è¦æ±‚**ï¼šæ€§èƒ½ã€å®‰å…¨ã€å¯ç»´æŠ¤æ€§æ ‡å‡†
6. **å®Œæ•´çš„å¼€å‘æµç¨‹**ï¼šä»è®¾è®¡åˆ°éƒ¨ç½²çš„å…¨æµç¨‹ç®¡ç†

è¯¥æ¶æ„æ”¯æŒé«˜å¹¶å‘è®¿é—®ã€æ°´å¹³æ‰©å±•ï¼Œå¹¶ä¸ºå›¢é˜Ÿåä½œå’Œé¡¹ç›®ç®¡ç†æä¾›äº†å®Œæ•´çš„æŒ‡å¯¼æ¡†æ¶ã€‚
